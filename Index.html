<!DOCTYPE html>
<html>
<head>
  <title>Leaflet.timeline Example</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet.timeline@1.6.0/dist/leaflet.timeline.min.js"></script>

  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    #map { height: 100%; width: 100%; }

    .leaflet-bottom.leaflet-left { width: 100%; }
    .leaflet-control-container .leaflet-timeline-controls {
      box-sizing: border-box;
      width: 100%;
      margin: 0 0 25px 0;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <script>
    function getColorFor(value) {
      return value >= 6  ? '#b35806' :
             value >= 3  ? '#f1a340' :
             value >= 1  ? '#fee0b6' :
             value >= 0  ? '#f7f7f7' :
             value >= -1 ? '#d8daeb' :
             value >= -3 ? '#998ec3' :
                           '#542788';
    }

    var background = L.tileLayer(
      'https://stamen-tiles-{s}.a.ssl.fastly.net/toner-background/{z}/{x}/{y}{r}.png',
      { subdomains: 'abcd', minZoom: 0, maxZoom: 20, attribution: '' }
    );

    var map = L.map("map", {
      layers: [background],
      center: [38, -95],
      zoom: 5
    });

    var timeline, timelineControl;

    function onLoadData(data) {
      console.log("Loaded:", data);

      timeline = L.timeline(data, {
        style: function (feature) {
          return {
            color: "#333",
            weight: 1,
            fillColor: getColorFor(feature.properties.DIFF),
            fillOpacity: 0.9
          };
        },
        waitToUpdateMap: true,
        onEachFeature: function (feature, layer) {
          layer.bindTooltip(
            '<h3>' + feature.properties.NAME + '</h3>' +
            '<p><br>Biden: <strong>' + feature.properties.DEM + '</strong>' +
            '<br>Trump: <strong>' + feature.properties.REP + '</strong></p>'
          );
        }
      });

      timelineControl = L.timelineSliderControl({
        formatOutput: function (date) {
          return new Date(date).toLocaleDateString();
        },
        enableKeyboardControls: true,
      });

      timeline.addTo(map);
      timelineControl.addTo(map);
      timelineControl.addTimelines(timeline);
    }
  </script>

  <script src="https://eppesta.github.io/Lab4part1/Lab4/statepolls.jsonp"></script>
</body>
</html>
